!-----------------------------------------------------------------------------
! (c) Crown copyright 2021 Met Office. All rights reserved.
! The file LICENCE, distributed with this code, contains details of the terms
! under which the code may be used.
!-----------------------------------------------------------------------------

!> This example tests the result of a sorting algorithm
!> used in coupling code
!>
!-------------------------------------------------------------------------------
module coupler_utils_mod_test

  ! Global use statements go here

  use constants_mod, only : i_def
  use coupler_utils_mod, only : bubble_sort

  use pFUnit_Mod

  implicit none

  private
  public :: sort_test

  ! The test case type, containing procedures to setup, run
  ! and clean up after a test.
  ! It can also contain data.

  @TestCase
  type, extends(TestCase), public :: lfric_coupled_test_type
    private
  contains
    procedure setUp
    procedure tearDown
    procedure sort_test
  end type lfric_coupled_test_type


contains

  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  !> The setUp subroutine is optional and is called prior to running the test.
  !> It is used to create and initialise types / data that are used in
  !> the tests
  subroutine setUp( this )

    implicit none

    class(lfric_coupled_test_type), intent(inout) :: this

    ! This section should create and initialise anything needed for the test

  end subroutine setUp

  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  !> The tearDown subroutine is optional and called after the test.
  !> It is used to destroy any types / data previously created by setUp()
  subroutine tearDown( this )


    implicit none

    class(lfric_coupled_test_type), intent(inout) :: this

    ! This section should destroy any previously created types / data

  end subroutine tearDown

  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  ! pfUnit will run each subroutine preceded by the @test line
  @test
  !> A test subroutine. There can be more than one of these.
  subroutine sort_test( this )

    ! This section is where the code for a self-contained test should be put

    implicit none

    class(lfric_coupled_test_type), intent(inout) :: this

    integer(kind=i_def) :: input(4) ! input data on output from
                                           ! bubble_sort sorted
    integer(kind=i_def) :: answer(4)! expected values
    integer(kind=i_def) :: order(4) ! expected index
    integer(kind=i_def) :: indx(4)  ! index on output from bubble_sort

    integer(i_def)   :: i

    ! Make up a matrix
    input(1) = 8_i_def
    input(2) = 12_i_def
    input(3) = 0_i_def
    input(4) = 3_i_def
    ! answer
    answer(1:4) = (/0_i_def, 3_i_def, 8_i_def, 12_i_def/)
    order(1:4) = (/3_i_def, 4_i_def, 1_i_def,   2_i_def/)

    call bubble_sort(input, indx, 4_i_def)

    @assertEqual( input, answer )
    @assertEqual( order, indx )


  end  subroutine sort_test

end module coupler_utils_mod_test
